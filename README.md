# Demonstrates new `@cap-js/typer` type generator with CAP 7

> **Note**: Follow this [link](https://github.com/stockbal/cap-samples/tree/main) to show all available scenarios

## Issues

### Usage of `Date` JavaScript type for CDS `Date` types [SOLVED]

CDS `Date`/`DateTime` types are generated as TypeScript `Date` types which produces problems as CAP does not really return `Date` objects but date `String`s.

```ts
import { Books } from "#cds-models/my/bookshop";

...

const books = await SELECT.from(Books);

for (let book of books) {
  // will result in an error as 'publishedOn' will not be a Date instance
  console.log(`Book ${book.title} was published in ${book.publishedOn.getFullYear()}`);
}
...
```

**Note**: Fixed with <https://github.com/cap-js/cds-typer/pull/29>

### Type checking not working correctly [SOLVED]

Although auto completion works correctly it is still possible to access any non existing property on an instance with a Type generated by `@cap-js/typer`:

Sample of generated file:

```ts
...
export function _BookAspect<TBase extends new (...args: any[]) => any>(Base: TBase) {
  return class Book extends Base {
        ID ?: number;
        title ?: string;
        stock ?: number;
        publishedOn ?: Date;
  };
}
...
```

If the return type of the generated aspect functions would be changed to `object` instead, the typescript compiler produces the expected syntax errors (see [cat-service.ts](./srv/cat-service.ts)).

**Note**: Fixed with <https://github.com/cap-js/cds-typer/pull/28>

### Testing with ts-jest

If dynamic imports are inside handler or test code, node might have to be executed with an [additional option](https://jestjs.io/docs/ecmascript-modules):

```json
  "test": "node --experimental-vm-modules node_modules/jest/bin/jest"
```

